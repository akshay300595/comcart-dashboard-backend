pipeline {
    agent any

    // Isse ye pakka hota hai ki Jenkins parameter ko pehchaan le
    parameters {
        string(name: 'BRANCH_NAME', defaultValue: 'master', description: 'Kaunsi branch build karni hai?')
    }

    stages {
        stage('Cleanup') {
            steps {
                echo "Purana kachra saaf kar rahe hain..."
                cleanWs()
            }
        }

        stage('Checkout') {
            steps {
                echo "GitHub se Code la rahe hain: Branch -> ${params.BRANCH_NAME}"
                // SCM checkout jo tumhare GUI settings ko use karega
                checkout scm: [
                    $class: 'GitSCM', 
                    branches: [[name: "refs/heads/${params.BRANCH_NAME}"]], 
                    userRemoteConfigs: [[url: 'https://github.com/akshay300595/comcart-dashboard-backend.git']]
                ]
            }
        }

        stage('Deploying to /tmp') {
            steps {
                sh '''
                    echo "Deploying files..."
                    mkdir -p /tmp/my-test-web
                    # Files copy karna
                    cp -v -r * /tmp/my-test-web/
                    # Permissions set karna
                    chmod -R 755 /tmp/my-test-web
                '''
            }
        }

        stage('Verification') {
            steps {
                echo "Final Check..."
                sh 'ls -l /tmp/my-test-web'
                echo "Bhai Build Success ho gaya!"
            }
        }
    }
    
    post {
        failure {
            echo "Kuch gadbad ho gayi... Console check karo!"
        }
    }
}